@page "/profile/enrollments"

@using Event_Management_System.Models.Base
@inject AuthService Auth
@inject EnrollmentService EnrollmentService
@inject NavigationManager Nav

<h3 class="title">My Enrollments</h3>

@if (user == null)
{
    <p class="text-muted">You must be logged in to view this page.</p>
}
else if (enrollments == null)
{
    <p class="text-muted">Loading enrollments...</p>
}
else if (enrollments.Count == 0)
{
    <p class="text-muted">You are not enrolled in any events yet.</p>
}
else
{
    <div class="enrollment-list">
        @foreach (var enrollment in enrollments)
        {
            <div class="enrollment-card">
                <div>
                    <h5>@enrollment.Event.EventTitle</h5>
                    <p class="event-desc">@enrollment.Event.Description</p>
                    <small>
                        Enrolled on: @enrollment.EnrollmentDate.ToShortDateString()
                    </small>
                </div>

                <button class="btn view-btn"
                        @onclick="() => GoToEvent(enrollment.Event.EventId)">
                    View Event
                </button>
            </div>
        }
    </div>
}

<button class="btn back-btn" @onclick="GoBack">
    Back to Profile
</button>

@code {
    private User? user;
    private List<Enrollment>? enrollments;

    protected override async Task OnInitializedAsync()
    {
        user = await Auth.GetCurrentUserAsync();

        if (user != null)
        {
            enrollments = await EnrollmentService
                .GetMyEnrollmentsAsync(user.UserId);
        }
    }

    private void GoBack()
    {
        Nav.NavigateTo("/profile");
    }

    private void GoToEvent(int eventId)
    {
        Nav.NavigateTo($"/events/{eventId}");
    }
}